## 分布式计算系统通信协议设计

使用TCP协议



### 文件协议

~~~
FILE\r\n                             <---header
name1;name2;name3;....nameN\r\n
size1;size2;size3;....sizeN\r\n
file1file2file3......fileN           <---body body是文件的二进制内容，没有分隔符

~~~

每接收完一份上述报文，需要返回一个ACK

~~~
ACK\r\n
~~~



### 参数协议

~~~
ARGS\r\n       <---header
size\r\n
bytes           <---body
~~~

参数必须以列表形式传输，列表的长度就是参数的组数，列表的每一个值是一组参数



### 类型报告协议

~~~
TYPE\r\n     
P\r\n     <---P/C 分别代表Producer, Consumer
num\r\n   <---本节点可以提供的计算核心数目，对于Producer来说，固定为0
~~~

对于任务节点类型报告无回复

对于生产者节点，回复有两种：已经有生产者且正在执行任务，会回复占用

~~~
OCCUPY\r\n
~~~

正常会回复当前在线任务节点列表

### 结果协议

结果必须是一个列表，列表的长度是结果的组数

~~~
RESULT\r\n       <---header
size\r\n
bytes            <---body
~~~

### 任务停止协议

停止当前执行的所有任务

~~~
STOP\r\n
~~~

终止确认

~~~
CONFIRM\r\n
~~~



### 任务节点列表协议

获取当前在线的任务节点的列表

~~~
GETNODES\r\n
~~~

返回任务节点的列表

~~~
NODES\r\n
length\r\n
ip:port:num;ip:port:num;......ip:port:num
~~~



### 错误报告

当消息执行错误的时候，会出现错误报告

~~~
ERROR\r\n
length\r\n
msg
~~~



### 任务开始确认

一般情况下，任务的发布首先包含了数份任务代码的文件报文，最后跟随一份参数文件。当然也可能只包含一份参数文件。

所以，当接收到参数文件之后，任务开始向计算节点进行发布。然后每当服务器收到一份任务开始的报告的时候就会向生产者节点回复一份任务开始确认

~~~
START\r\n
length\r\n    <---任务节点的length是0
ip:port
~~~



### 任务分发开始协议

当生产者节点开始分发第一份代码文件之前，需要先发送一个分发开始报文，主要作用是通知服务器可以清空任务依赖代码列表的list了。其实实现方式有很多，我选这种吧。

~~~
CLEAR\r\n
~~~

